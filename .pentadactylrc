"
" Pentadactyl dotfile
" ~/.pentadactylrc
" Name: nil
"
" Bugs & To-DO ---------------------------------------------------------------- {{{

" lemon/limey/uushi not working
" <C-v>/<C-p> aren't working!!
"   Neither does <C-z>
" google search suggestions aren't working. unless i specifically go to 'g'
" using digits autogoes to a url page. stahp. let them use google.
" toggled scrollbar doesn't always work
    " they also don't show up until refreshed page
" Make all colors gray. It's a weird blotch right now of white and gray.
"    turn the highlighted search term as yellow.
" When I try to hit a popup X box, the status line shifts everything up, then it shifts it down and so it goes screwy in a loop, making it hard to hit the box.
" Function to tabdetach if there's not a 2nd Firefox window, tabattach to the other window if there is (this compounds 3 keys into one (:taba 1,:taba 2,:tabd).
" Jumps in same buffer without changing pages. (same problem in Vim)
" set tabmove to move to 1st position, if it's already in last position (similarly for first to last)
" g not always working on reddit

" some way to navigate all my bookmarks with keyboards, i.e., a url link with all bookmarks with the folders, then i can use the f/F hints to hint the links or the folders.
" how to work with recently closed tabs/windows, and viewing them, as well as bunch of "back"'s history?

" Wishlist:
" True Bookmark support.
"   No -folder option when adding bookmarks through :bmark.
"   Better navigation through :bmarks, c.f., through folders with GUI.
" Same with history dialog.
" Navigate between multiple scrollbars on the same tab, e.g., on feedly.
" Check list of back's, in case hitting it once keeps redirecting you instead, or you just want to check something way back.
" Better caret support. Possibly where caret starts at center of screen instead of wherever. I dunno something. Right now trying to cp+paste with it is just terrible.
" Not clear when I'm in text edit mode during cmd-line, and how to escape it.
" I can't hint links that are popup windows or when the damn hints are off the left border of the screen..
"   Also I can't hint out of the popup windows, e.g., when editing entries in MAL.
" No support for <Leader><Leader> (though <Leader>,> works.

" }}}
" Settings {{{
" -----------------------------------------------------------------------------

loadplugins '\.(js|penta)$'
group user

highlight CompTitle color: #00000 !important; background: #F0F0F0 !important;
highlight CompTitleSep color: #000000 !important; background: #F0F0F0 !important;
highlight CompItem background: #F0F0F0 !important;
highlight CompMore background: #F0F0F0 !important;
highlight CompLess background: #F0F0F0 !important;
highlight CmdLine background: #F0F0F0 !important;
highlight Find background: rgba(204,51,255,0.5) !important;
highlight CompItem[selected] background: #DCDCDC !important;
highlight Hint font-size: 14px; background: rgba(1,132,208,0.8) !important; border: 2px solid rgb(1,132,208); padding: 4px; border-radius: 3px; font-weight: bold; margin-left: -25px; color: white; font-family: lime; line-height:1em;
highlight HintActive background: rgba(145,197,43,0.8) !important;
highlight HintElem background: rgba(255, 209, 20, 0.7) !important;
highlight StatusLine -moz-appearance: #F0F0F0 !important; font-weight: none; background: #F0F0F0 !important; border: 0px !important; min-height: 15px !important; text-shadow: none !important; color: black !important; font: normal 12px 'lemon' !important;
"Neither font-family or font: seems to work with specific fonts, e.g., lemon,limey,uushi.
"highlight CmdLine -a font-family: Dina !important;
"highlight Link -a font-family: Dina !important;
"highlight CompTitle -a font-family: Dina !important;
"highlight CompTitleSep -a font-family: Dina !important;
"highlight CompItem -a font-family: Dina !important;
"highlight CompMore -a font-family: Dina !important;
"highlight CompLess -a font-family: Dina !important;

unmap!
iunmap!
tunmap!
cunmap!

set complete=slSf
set guioptions=
set defsearch=g
set maxitems=5
set newtab=help
set showstatuslinks=command
" when rehashing, multitab doesn't work until i make/close a tab. I don't really like it anyways, so whatever.
" Also, it's available in TabMixPlus instead.
"set showtabline=multitab
set showtabline=always
set titlestring=
set hlfind
set passkeys+=reddit.com:JKeqcCaswb<CR>
set passkeys+=boards.4chan.org:JK<C-j><C-k>eqQcC<CR>
set passkeys+=cloud.feedly.com:?<CR>
"JK/rjknpovMmsbV

" Tab-Options Plugin.
set tabclose=right,opener,left,previous
" I want it to open tabs at the end if I open a bunch of links, but otherwise to the right of the current "group". This is more intuitive in Chrome which does this automatically.
set tabopen=link:end,orphan:end,external:end

" This is the same as my EasyMotion's default except that now 'h' is at the far-left, so it indexes properly.
set hintkeys="hjklfdsaguiotrewqnmvcpxzbyKLFDSAHGUIOTREWQNMVCPXZBY"

" I have no idea why this one resets back to true once in a while.
set! general.smoothScroll=false

" }}}
" Mappings - Unmapped {{{
" -----------------------------------------------------------------------------
" These are keys that are generally useless for me. I can always just not use it, but <Nop>ing everything eases my mind as I know exactly what keys do what, and how to prioritize my keybinds most effectively.

map -modes=n,t * <Nop>
map -modes=n,t # <Nop>
map -modes=n,t <Home> <Nop>
map -modes=n,t <PageUp> <Nop>
map -modes=n,t <PageDown> <Nop>
map -modes=n,t <End> <Nop>
map -modes=n,t <Up> <Nop>
map -modes=n,t <Left> <Nop>
map -modes=n,t <Right> <Nop>
map -modes=n,t <Down> <Nop>
map -modes=n <C-]> <Nop>
map -modes=n B <Nop>
map -modes=n D <Nop>
map -modes=n R <Nop>
map -modes=n S <Nop>
map -modes=n s <Nop>
map -modes=n <C-i> <Nop>
map -modes=n <C-u> <Nop>
map -modes=n <C-y> <Nop>
map -modes=n <C-n> <Nop>
map -modes=n <C-p> <Nop>
" I hit this one way too f--ing often.
map -modes=n gf <Nop>
map -modes=n gh <Nop>
map -modes=n -builtin gs gf

map -modes=c <C-c> <Nop>
map -modes=c <C-]> <Nop>
map -modes=c <Up> <Nop>
map -modes=c <Down> <Nop>
map -modes=c <S-Up> <Nop>
map -modes=c <S-Down> <Nop>
map -modes=c <PageDown> <Nop>
map -modes=c <PageUp> <Nop>

map -modes=i <C-[> <Nop>
map -modes=i <C-d> <Nop>
map -modes=i <C-i> <Nop>
map -modes=i <C-h> <Nop>

" Mozilla/Browser commands.
map -modes=i,n <C-r> <Nop>
map -modes=i,c <C-g> <Nop>
map -modes=n <C-w> <Nop>
map -modes=n <Tab> <Nop>
map -modes=i <Home> <Nop>
map -modes=i <PageUp> <Nop>
map -modes=i <PageDown> <Nop>
map -modes=i <End> <Nop>
map -modes=n <Space> <Nop>
map -modes=i,n <F5> <Nop>
" My alternatives aren't currently working. When they do, Nop these to get used to the others.
"map -modes=i,c <Left> <Nop>
"map -modes=i,c <Right> <Nop>
"map -modes=i <Up> <Nop>
"map -modes=i <Down> <Nop>
"map -modes=i <C-z> <Nop>
"map -modes=i <C-x> <Nop>
"map -modes=i <C-c> <Nop>
" Not sure if I like C-V or C-P for quick edit pastes.
"map -modes=i <C-v> <Nop>

" Text Edit mde.
map -modes=t <C-a> <Nop>
map -modes=t <C-x> <Nop>
map -modes=t $ <Nop>
map -modes=t t <Nop>
map -modes=t T <Nop>

" }}}
" Mappings - General {{{
" -----------------------------------------------------------------------------

" Leader key. Note that <Leader> isn't actually a real command.
map , <Leader>

" Dialogs & Stuff.
map -modes=n -builtin <C-r> :rehash<CR>
map -modes=n -builtin <C-e> :dialog places<CR>
map -modes=n -builtin <C-d> :dialog addons<CR>
map -modes=n -builtin <C-p> :dialog preferences<CR>
map -modes=n -builtin <C-y> :dialog downloads<CR>
map -modes=n -builtin <C-S-p> :dialog print<CR>
map -modes=n -builtin <C-w>  :tabopen about:sync-tabs<CR>

" Text Edit Mode. How ingenious! I'll just map you to the Vim cmd-line default.
map -modes=i,c -builtin <C-f> <C-T>

" Clear cmd-line messages and search highlights.
" Originally mapped to <Esc>, but was having funny issues with escaping caret mode. Could probably function ifelse this, but whatevs, this makes more sense with my Vim commands.
map -modes=n -builtin <Leader><Space> /3u1<CR>:<CR>

" A Vim favorite.
map -modes=n -builtin ; :

" Enter last input box you went to, otherwise go to first!
map -modes=n -builtin i gi

" For the rarer Caret mode.
map -modes=n -builtin I i

" A temporary fix for caret mode. Only con is that it doesn't tell you that you yanked and what you yanked.
map -modes=caret -builtin y <C-v><C-c>

" Toggle scrollbar (to see my progress for long pages).
"map -modes=n -builtin <Leader>s :set guioptions!=r<CR>
map -modes=n -builtin <Leader>st :set guioptions!=s<CR>

" Bookmark support in pentadactyl sucks. Use native GUI for now.
map -modes=n -builtin a <C-v><C-d>

" [e]xtended hints.
map -modes=n -builtin e ;

" Stay in hints mode with everything sent to background tabs.
map -modes=n -builtin <C-f> g;b

" The only extended hints mode I really use.
map -modes=n -builtin <Leader>f ;;

" Scrolling
map -modes=n -builtin j 5j
map -modes=n -builtin k 5k
map -modes=n -builtin <C-j> <C-d>
map -modes=n -builtin <C-k> <C-u>
map -modes=n -builtin K h
map -modes=n -builtin J l

" +/- Command-line history.
map -modes=c -builtin <C-j> <Down>
map -modes=c -builtin <C-k> <Up>

" Open tab in background.
map -modes=n -builtin <C-t> :tabopen!<Space>

" +/- Tabs.
map -modes=n -builtin h gT
map -modes=n -builtin l gt

" Move +/- tab.
map <silent> -modes=n -builtin <C-h> :tabmove -1<CR>
map <silent> -modes=n -builtin <C-l> :tabmove +1<CR>

" Go to first/last tab.
map -modes=n -builtin 0 g0
map -modes=n -builtin $ g$

" Go to specific # tab, to keep in line with my tiling WM.
map -modes=n -builtin <C-1> :buffer 1<CR>
map -modes=n -builtin <C-2> :buffer 2<CR>
map -modes=n -builtin <C-3> :buffer 3<CR>
map -modes=n -builtin <C-4> :buffer 4<CR>
map -modes=n -builtin <C-5> :buffer 5<CR>
map -modes=n -builtin <C-6> :buffer 6<CR>
map -modes=n -builtin <C-7> :buffer 7<CR>
map -modes=n -builtin <C-8> :buffer 8<CR>
map -modes=n -builtin <C-9> :buffer 9<CR>

" Of the Windows default <C-> keys, <C-S> is definitely not needed anywhere here (neither are some others I <Nop>'d. Hence I'm mapping it to stop page load, which I inadvertently do so many damn times anyways.
map -modes=n -builtin <C-s> <C-c>

" Move back to the previously used tab, damnit! tab-options plugin doesn't seem to always work in this way.
"map -modes=n -builtin d <C-v><C-w>

" Yanks: more intuitive.
map -modes=n -builtin y Y
map -modes=n -builtin Y y

" Go to parent url/root.
" I'm starting to prefer the default keybinds for these two.
"map -modes=n -builtin <BS> gu
"map -modes=n -builtin <S-BS> gU

" Jumps. They don't quite work yet.
"map -modes=n -builtin <C-u> <C-i>
"map -modes=n <C-o> <Nop>

" Move tab to another window.
map -modes=n -builtin <Leader>1 :tabattach 1<CR>
map -modes=n -builtin <Leader>2 :tabattach 2<CR>
map -modes=n -builtin <Leader>3 :tabdetach<CR>

" My Vim insert mode paste.
map -modes=i,c -builtin <C-p> <C-v><C-v>

" I still like select-all, even though I don't use any other browser insert command since Text Edit Mode is boss.
map -modes=n,i,c,t -builtin <C-a> <pass>

" For the rich text editors in browser.
map -modes=i -builtin <C-i> <pass>

" Open private window.
map -modes=n -builtin <Leader>p <C-V><C-S-p>

" huehuehue
map -modes=n -builtin <Leader>44 :tabopen! http://boards.4chan.org/<CR>
map -modes=n -builtin <Leader>4g :tabopen! http://boards.4chan.org/g/<CR>
map -modes=n -builtin <Leader>4m :tabopen! http://boards.4chan.org/mu/<CR>
map -modes=n -builtin <Leader>4f :tabopen! http://boards.4chan.org/fa/<CR>
map -modes=n -builtin <Leader>4l :tabopen! http://boards.4chan.org/lit/<CR>
map -modes=n -builtin <Leader>4a :tabopen! http://boards.4chan.org/a/<CR>
map -modes=n -builtin <Leader>4s :tabopen! http://boards.4chan.org/sci/<CR>
map -modes=n -builtin <Leader>rr :tabopen! http://reddit.com<CR>
map -modes=n -builtin <Leader>rt :tabopen! http://www.reddit.com/r/math<CR>
map -modes=n -builtin <Leader>rf :tabopen! http://www.reddit.com/r/malefashionadvice<CR>
map -modes=n -builtin <Leader>rn :tabopen! http://www.reddit.com/r/frugalmalefashion<CR>
map -modes=n -builtin <Leader>rc :tabopen! http://www.reddit.com/r/bicycling+bikeporn<CR>
map -modes=n -builtin <Leader>ru :tabopen! http://www.reddit.com/r/unixporn<CR>
map -modes=n -builtin <Leader>rd :tabopen! http://www.reddit.com/r/android<CR>
map -modes=n -builtin <Leader>rb :tabopen! http://www.reddit.com/r/battlestations<CR>
map -modes=n -builtin <Leader>rp :tabopen! http://www.reddit.com/r/buildapc<CR>
map -modes=n -builtin <Leader>ra :tabopen! http://www.reddit.com/r/anime<CR>
map -modes=n -builtin <Leader>rm :tabopen! http://www.reddit.com/r/classicalmusic<CR>

" Forums.
map -modes=n -builtin <Leader>sf :tabopen! http://www.styleforum.net/f/6654/marketplace/-filter-/RmlsdGVyJTVCdHlwZSU1RCU1QjElNUQvMS9GaWx0ZXIlNUJ0eXBlJTVEJTVCNCU1RC8xL0ZpbHRlciU1QnN0YXRlJTVEJTVCT3BlbiU1RC8xL0ZpbHRlciU1QmNhdGVnb3J5VGFnJTVELy0xL0ZpbHRlciU1Qm9yZGVyX2J5JTVEL0NsYXNzaWZpZWQuYnVtcF9hdC9wYWdlLzA,/<CR>
"map -modes=n -builtin <Leader>fh :tabopen! http://hypebeast.com/forums<CR>
"map -modes=n -builtin <Leader>u :tabopen! http://supertalk.superfuture.com/<CR>
"map -modes=n -builtin <Leader>h :tabopen! http://www.head-fi.org/f/<CR>
"map -modes=n -builtin <Leader>k :tabopen! http://geekhack.org/index.php<CR>

" Others.
map -modes=n -builtin <Leader>d :tabopen! https://github.com/nil-/dotfiles<CR>
map -modes=n -builtin <Leader>e :tabopen! http://www.ebay.com/<CR>
map -modes=n -builtin <Leader>f :tabopen! http://cloud.feedly.com/#category%2FAssociates<CR>
map -modes=n -builtin <Leader>mm :tabopen! https://mail.google.com/mail/u/1/#inbox | https://mail.google.com/mail/u/0/#inbox<CR>
map -modes=n -builtin <Leader>md :tabopen! https://mail.google.com/mail/u/0/#inbox<CR>
map -modes=n -builtin <Leader>mb :tabopen! https://mail.google.com/mail/u/1/#inbox<CR>

" Media pages.
map -modes=n -builtin <Leader>ap :tabopen! http://myanimelist.net/profile/nil-<CR>
map -modes=n -builtin <Leader>al :tabopen! http://myanimelist.net/animelist/nil-&order=4<CR>
map -modes=n -builtin <Leader>am :tabopen! http://myanimelist.net/mangalist/nil-&order=4<CR>
map -modes=n -builtin <Leader>an :tabopen! http://myanimelist.net/panel.php<CR>
map -modes=n -builtin <Leader>b :tabopen! http://nilblogs.wordpress.com/<CR>
map -modes=n -builtin <Leader>g :tabopen! http://www.goodreads.com/user/show/7207396-nil<CR>
map -modes=n -builtin <Leader>ii :tabopen! http://www.imdb.com/user/ur33286458/ratings?start=1&view=compact&sort=your_ratings:desc&defaults=1&my_ratings=restrict&defaults=1&my_ratings=restrict<CR>
map -modes=n -builtin <Leader>iw :tabopen! http://www.imdb.com/user/ur33286458/watchlist?start=1&view=compact&sort=release_date_us:desc&defaults=1&lists=watchlist&defaults=1&lists=watchlist<CR>
map -modes=n -builtin <Leader>vg :tabopen! http://dl.dropboxusercontent.com/u/30753123/List/Video%20Game%20List.html<CR>
map -modes=n -builtin <Leader>vn :tabopen! http://dl.dropboxusercontent.com/u/30753123/List/Visual%20Novel%20List.html<CR>
map -modes=n -builtin <Leader>y :tabopen! http://rateyourmusic.com/~nilin<CR>
map -modes=n -builtin <Leader>l :tabopen! http://www.last.fm/user/nil1729<CR>

" Private trackers.
map -modes=n -builtin <Leader>t :tabopen! bakabt.me | animebytes.tv | blackcats-games.net | what.cd | iptorrents.com | torrent-invites.com/10-giveaways<CR>

" Temp
map -modes=n -builtin <Leader>n :tabopen! nyaa gatchaman crowds | nyaa neptun | nyaa prisma | nyaa world | nyaa uchouten kazoku | nyaa monogatari | nyaa genshiken | nyaa servant | nyaa gin no saji | nyaa stella | nyaa free<CR>

" }}}
" Functions {{{
" -----------------------------------------------------------------------------

" Bug: I have to use backslashes to get out of single quotes/double quotes. Annoying!
" Search multiple sites in one. {{{
javascript <<EOF
    userContext.searchDictionary = function (selection) {
        commands.execute("tabopen wikt " + selection);
        commands.execute("tabopen g define " + selection);
    };
EOF
javascript <<EOF
    userContext.searchGiki = function (selection) {
        commands.execute("tabopen g " + selection);
        commands.execute("tabopen wiki " + selection);
    };
EOF
javascript <<EOF
    userContext.searchArch = function (selection) {
        commands.execute("tabopen archpkg " + selection);
        commands.execute("tabopen aur " + selection);
    };
EOF
javascript <<EOF
    userContext.searchAni = function (selection) {
        commands.execute("tabopen nyaa " + selection);
        commands.execute("tabopen animebytes " + selection);
        commands.execute("tabopen baka " + selection);
    };
EOF
javascript <<EOF
    userContext.searchMal = function (selection) {
        commands.execute("tabopen wiki " + selection);
        commands.execute("tabopen mal " + selection);
    };
EOF
" }}}
" Custom search commands.
command define -nargs=* -js userContext.searchDictionary(args)
command giki -nargs=* -js userContext.searchGiki(args)
command arch -nargs=* -js userContext.searchArch(args)
command ani -nargs=* -js userContext.searchAni(args)
command mal -nargs=* -js userContext.searchMal(args)

" Most used generic ones.
map -modes=n -builtin s :define<Space>
map -modes=n -builtin S :giki<Space>

" Edit in external editor, with filetype syntax! {{{
javascript <<EOF
function editExternallyWithFiletype() {
    var save_editor = options["editor"];
    var filetype = editExternallyFiletype();
    console.log(filetype)
    // Insert the :setf command before any existing +cmd, as there can be only one such argument.
    options["editor"] = options["editor"].replace(/ "\+/, " \"+setf " + filetype + "|")
    if (options["editor"] == save_editor) {
        // The 'editor' setting doesn't yet contain a passed +cmd; append it.
        options["editor"] += " \"+setf " + filetype + "\"";
    }
    editor.editFieldExternally();
    options["editor"] = save_editor;
}
EOF
javascript <<EOF
function editExternallyFiletype() {
    var host = buffer.URL.host
    switch(host.replace(/^www\./, "")) {
        case "github.com":
        if (! buffer.URL.path.match("/wiki/"))
        return "markdown";
        case "stackoverflow.com":
        return "markdown";
    }
    if (host.match(/.*\.4chan\.org$/))
        return "4chan";
}
EOF
" }}}
map -modes=i -builtin <C-e> -javascript editExternallyWithFiletype()

" }}}
" Macros {{{
" -----------------------------------------------------------------------------

cabbreviate pent pentadactyl

" vim:filetype=pentadactyl
" }}}
